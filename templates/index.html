<!DOCTYPE html>
<html lang="bn">
<head>
    <title>I'M JUBAYER - </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root { --bg: #000; --primary: #00ffff; --box: rgba(22, 27, 34, 0.8); --accent: #00ffff; }
        body { background: var(--bg); color: #fff; font-family: 'Rajdhani', sans-serif; margin: 0; padding: 0; }
        #particles-js { position: fixed; width: 100%; height: 100%; z-index: -1; }
        .container { width: 92%; max-width: 600px; margin: 20px auto; }
        .header { text-align: center; padding: 20px; font-family: 'Orbitron', sans-serif; color: var(--primary); letter-spacing: 2px; }
        .box { background: var(--box); border: 1px solid rgba(0,255,255,0.2); border-radius: 15px; padding: 20px; margin-bottom: 20px; backdrop-filter: blur(10px); }
        .upload-card { border: 2px dashed var(--primary); text-align: center; cursor: pointer; }
        .status-badge { padding: 4px 10px; border-radius: 5px; font-size: 11px; font-weight: bold; }
        .status-running { background: rgba(0, 255, 65, 0.2); color: #00ff41; border: 1px solid #00ff41; }
        .status-offline { background: rgba(255, 71, 87, 0.2); color: #ff4757; border: 1px solid #ff4757; }
        .button-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px; }
        .btn-m { padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; text-align: center; font-size: 12px; display: flex; align-items: center; justify-content: center; gap: 5px; text-decoration: none; color: #fff; }
        .run { background: #00d2ff; color: #000; }
        .stop { background: #ff4757; }
        .json-btn { background: #8e44ad; }
        .edit-btn { background: #58a6ff; color: #000; }
        .del-btn { background: #333; color: #ff4d4d; border: 1px solid #ff4d4d; }
        pre { background: #080808; color: #00ff41; padding: 10px; border-radius: 8px; font-size: 10px; height: 100px; overflow-y: auto; border: 1px solid #222; }
        
        /* Modal Style */
        #fmModal, #jsonModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:2000; padding:15px; box-sizing: border-box; }
        .modal-content { background: #161b22; height: 100%; border-radius: 15px; border: 1px solid var(--primary); display: flex; flex-direction: column; padding: 15px; }
        .file-item { padding: 10px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

<div id="particles-js"></div>

<div class="container">
    <div class="header"><h1>IM JUBAYER</h1></div>

    <div class="box upload-card">
        <form id="uploadForm" method="POST" action="/upload" enctype="multipart/form-data">
            <input type="file" name="file" id="fileInput" accept=".zip" required style="display:none;" onchange="document.getElementById('uploadForm').submit()">
            <label for="fileInput" style="cursor:pointer; display:block;">
                <i class="fa-solid fa-cloud-arrow-up" style="font-size: 30px; color: var(--primary);"></i>
                <p>Click to Upload ZIP Project</p>
            </label>
        </form>
    </div>

    {% for app in apps %}
    <div class="box">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <span style="color:var(--primary); font-family:'Orbitron';">{{ app.name }}</span>
            <span id="status-{{ app.name }}" class="status-badge {% if app.running %}status-running{% else %}status-offline{% endif %}">
                ● {% if app.running %}RUNNING{% else %}OFFLINE{% endif %}
            </span>
        </div>
        
        <div class="button-grid">
            <a href="/run/{{ app.name }}" class="btn-m run"><i class="fa-solid fa-play"></i> START</a>
            <a href="/stop/{{ app.name }}" class="btn-m stop"><i class="fa-solid fa-stop"></i> STOP</a>
            <button onclick="openFM('{{ app.name }}')" class="btn-m edit-btn"><i class="fa-solid fa-code"></i> EDIT</button>
            <button onclick="searchJSON('{{ app.name }}')" class="btn-m json-btn"><i class="fa-solid fa-magnifying-glass"></i> JSONS</button>
            <button onclick="confirmDelete('{{ app.name }}', '/delete/{{ app.name }}')" class="btn-m del-btn"><i class="fa-solid fa-trash"></i> DELETE</button>
        </div>
        <pre id="log-{{ app.name }}">Initializing logs...</pre>
    </div>
    {% endfor %}
</div>

<div id="jsonModal">
    <div class="modal-content" style="max-height: 80vh; margin-top: 5vh;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3 style="color:var(--primary); margin:0;">JSON FILES</h3>
            <button onclick="document.getElementById('jsonModal').style.display='none'" style="background:#ff4d4d; border:none; color:white; padding:5px 15px; border-radius:5px;">X</button>
        </div>
        <div id="jsonFileList" style="overflow-y:auto; flex:1;"></div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script>
    particlesJS('particles-js', { "particles": { "number": { "value": 50 }, "color": { "value": "#00ffff" }, "shape": { "type": "circle" }, "opacity": { "value": 0.5 }, "size": { "value": 3 }, "line_linked": { "enable": true, "distance": 150, "color": "#00ffff", "opacity": 0.2, "width": 1 }, "move": { "enable": true, "speed": 2 } } });

    function updateSystem() {
        {% for app in apps %}
            fetch('/get_log/{{ app.name }}').then(res => res.json()).then(data => {
                document.getElementById('log-{{ app.name }}').innerText = data.log || "No logs yet...";
                const badge = document.getElementById('status-{{ app.name }}');
                badge.innerText = "● " + data.status;
                badge.className = "status-badge " + (data.status === "RUNNING" ? "status-running" : "status-offline");
            });
        {% endfor %}
    }
    setInterval(updateSystem, 3000);

    function searchJSON(name) {
        const list = document.getElementById('jsonFileList');
        list.innerHTML = "<p>Searching...</p>";
        document.getElementById('jsonModal').style.display = 'block';
        fetch('/search_json/' + name).then(res => res.json()).then(data => {
            if(data.json_files.length === 0) { list.innerHTML = "<p>No JSON files found.</p>"; return; }
            let html = "";
            data.json_files.forEach(f => {
                html += `<div class="file-item">
                    <span>${f.name}</span>
                    <a href="/download_file?project=${name}&filename=${f.path}" style="color:#00ff41; text-decoration:none;"><i class="fa-solid fa-download"></i></a>
                </div>`;
            });
            list.innerHTML = html;
        });
    }

    function confirmDelete(name, url) {
        Swal.fire({ title: 'Delete?', text: name, icon: 'warning', showCancelButton: true, confirmButtonColor: '#ff4d4d' }).then(res => { if(res.isConfirmed) window.location.href = url; });
    }
</script>
</body>
</html>
